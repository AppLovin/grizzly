
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2017-05-03
 Rendered using Maven Reflow Skin 1.0.0 (http://andriusvelykis.github.com/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Project Grizzly - SPDY Overview</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />
 
		<link href="//netdna.bootstrapcdn.com/bootswatch/2.2.2/cosmo/bootstrap.min.css" rel="stylesheet" />
		<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="https://grizzly.java.net/css/bootswatch.css" rel="stylesheet" />
		<link href="https://grizzly.java.net/css/reflow-skin.css" rel="stylesheet" />
		
		<link href="//yandex.st/highlightjs/7.3/styles/solarized_dark.min.css" rel="stylesheet" />
		
		<link href="https://grizzly.java.net/css/lightbox.css" rel="stylesheet" />
		
		<link href="https://grizzly.java.net/css/site.css" rel="stylesheet" />
		<link href="https://grizzly.java.net/css/print.css" rel="stylesheet" media="print" />
		
		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

	</head>

	<body class="page-spdy project-site" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="index.html">Project <span class="color-brown">Grizzly</span></a>
					<div class="nav-collapse">
						<ul class="nav pull-right">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Download <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="dependencies.html" title="Download">Download </a></li>
								</ul>
							</li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="overview.html" title="Overview">Overview </a></li>
									<li><a href="dependencies.html" title="Dependencies">Dependencies </a></li>
									<li class="dropdown-submenu">
										<a href="hack" title="Core Framework">Core Framework </a>
										<ul class="dropdown-menu">
											<li><a href="memory.html" title="Memory Management">Memory Management </a></li>
											<li><a href="iostrategies.html" title="I/O Strategies">I/O Strategies </a></li>
											<li><a href="transportsconnections.html" title="Transports and Connections">Transports and Connections </a></li>
											<li><a href="filterchainfilters.html" title="FilterChain and Filters">FilterChain and Filters </a></li>
											<li><a href="coreconfig.html" title="Core configuration">Core configuration </a></li>
											<li><a href="portunification.html" title="Port Unification">Port Unification </a></li>
											<li><a href="monitoring.html" title="Monitoring">Monitoring </a></li>
											<li><a href="extras.html" title="Extras">Extras </a></li>
											<li><a href="bestpractices.html" title="Best Practices">Best Practices </a></li>
											<li><a href="quickstart.html" title="Quick Start">Quick Start </a></li>
											<li><a href="samples.html" title="Samples">Samples </a></li>
										</ul>
									</li>
									<li class="dropdown-submenu">
										<a href="hack" title="HTTP">HTTP </a>
										<ul class="dropdown-menu">
											<li><a href="httpframework.html" title="Core HTTP Framework">Core HTTP Framework </a></li>
											<li><a href="httpserverframework.html" title="HTTP Server Framework">HTTP Server Framework </a></li>
											<li><a href="http2.html" title="HTTP/2">HTTP/2 </a></li>
											<li><a href="httpserverframeworkextras.html" title="HTTP Server Framework Extras">HTTP Server Framework Extras </a></li>
											<li><a href="comet.html" title="Comet">Comet </a></li>
											<li><a href="jaxws.html" title="JAXWS">JAXWS </a></li>
											<li><a href="websockets.html" title="WebSockets">WebSockets </a></li>
											<li><a href="ajp.html" title="AJP">AJP </a></li>
											<li class="active"><a href="" title="SPDY">SPDY </a></li>
										</ul>
									</li>
									<li class="dropdown-submenu">
										<a href="hack" title="Javadocs/XREF">Javadocs/XREF </a>
										<ul class="dropdown-menu">
											<li><a href="https://grizzly.java.net/docs/2.3/apidocs" title="Grizzly 2.3 Javadoc" class="externalLink">Grizzly 2.3 Javadoc </a></li>
											<li><a href="https://grizzly.java.net/docs/2.3/xref" title="Grizzly 2.3 XRef" class="externalLink">Grizzly 2.3 XRef </a></li>
											<li><a href="https://grizzly.java.net/docs/2.2/apidocs" title="Grizzly 2.2 Javadoc" class="externalLink">Grizzly 2.2 Javadoc </a></li>
											<li><a href="https://grizzly.java.net/docs/2.2/xref" title="Grizzly 2.2 XRef" class="externalLink">Grizzly 2.2 XRef </a></li>
											<li><a href="https://grizzly.java.net/docs/1.9/apidocs" title="Grizzly 1.9 Javadoc" class="externalLink">Grizzly 1.9 Javadoc </a></li>
											<li><a href="https://grizzly.java.net/docs/1.9/xref" title="Grizzly 1.9 XRef" class="externalLink">Grizzly 1.9 XRef </a></li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>
		
	<div class="container">
	
	<!-- Masthead
	================================================== -->
	<header class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="index.html" id="bannerLeft"><h1><img src="images/grizzlyHead.png"/>&nbsp;<span class="color-black">Project</span> Grizzly</h1></a>
					<p class="lead">NIO Event Development Simplified</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
		<div>
			<ul class="breadcrumb">
				<li class="publishDate version-date">Last Published: 2017-05-03</li>
			</ul>
		</div>
		<hr class="toc-separator" />
		<div id="toc-bar" class="navbar">
			<div class="navbar-inner">
				<div id="toc-scroll-target" class="container">
					<ul id="toc" class="nav">
						<li class="toplevel"><a href="#SPDY_Overview" title="SPDY Overview">SPDY Overview</a></li>
						<li class="toplevel"><a href="#How_it_works" title="How it works">How it works</a></li>
						<li class="toplevel"><a href="#SPDY_Server_Push" title="SPDY Server Push">SPDY Server Push</a></li>
						<li class="toplevel"><a href="#SPDY_Configuration_Grizzly_standalone" title="SPDY Configuration (Grizzly standalone)">SPDY Configuration (Grizzly standalone)</a></li>
		<li class="divider-vertical"></li>
		<li class="dropdown">
			<a href="#" title="More&hellip;" class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#">&hellip; <b class="caret"></b></a>
			<ul class="dropdown-menu" role="menu">
								<li><a href="#SPDY_Configuration_GlassFish_4" title="SPDY Configuration (GlassFish 4)">SPDY Configuration (GlassFish 4)</a></li>
								<li><a href="#Dependencies" title="Dependencies">Dependencies</a></li>

			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<div class="section"> 
 <div class="page-header">
  <h2 id="SPDY_Overview">SPDY Overview</h2>
 </div> 
 <p>Starting with 2.3, Grizzly offers support for SPDY/3. The goal of SPDY is to reduce web page load time. This is achieved by prioritizing and multiplexing the transfer of web page resources so that only one connection per client is required.</p> 
 <p>Currently, Grizzly implements only SPDY/3 support per <a class="externalLink" href="http://tools.ietf.org/html/draft-mbelshe-httpbis-spdy-00">http://tools.ietf.org/html/draft-mbelshe-httpbis-spdy-00</a> with a few caveats.</p> 
 <ul> 
  <li> <p>As Grizzly is primarily providing SPDY support for typical HTTP/1.1 use cases, the implementation ignores header frames that are sent out-of-band of the typical request/response cycle.</p></li> 
  <li> <p>Expect/100-Continue is not currently supported. This is a weak area of the specification. There has been some discussion on this topic with the protocol specification authors, but no resolution has been published.</p></li> 
  <li> <p>No support of Credential frames. Give this, we recommend that the user-agent, if possible, not share SPDY sessions between multiple origins. Additionally, if mutual certificate authentication is required, we recommend that the Grizzly SSL configuration set client-auth to need.</p></li> 
  <li> <p>As SPDY requires the Next Protocol Negotiation (NPN) TLS extension, Grizzly’s spdy implementation will only operate with OpenJDK 7u14. Later versions of the OpenJDK should work, but there may be some gotchas that would require us to release new versions of the Grizzly NPN implementation.</p></li> 
 </ul> 
 <div class="section"> 
  <h3 id="How_it_works">How it works</h3> 
  <p>The SPDY protocol implementation is mainly represented by two Filters: SpdyFramingFilter, SpdyHandlerFilter. The SpdyFramingFilter is responsible for constructing/deconstructing SPDY frame messages and SpdyHandlerFilter contains the actual processing logic, which works as a codec between SPDY and HTTP messages. All the Filters upstream to SpdyHandlerFilter receive HTTP messages for processing, so they are not even aware of SPDY protocol.</p> 
  <p>In order to simplify HttpServer SPDY configuration, there is a SpdyAddOn available, which may be registered on the required HttpServer’s NetworkListener like:</p> 
  <div class="source"> 
   <pre>HttpServer httpServer = new HttpServer();
NetworkListener listener =
         new NetworkListener(&quot;grizzly&quot;,
                             NetworkListener.DEFAULT_NETWORK_HOST,
                             PORT);
listener.setSecure(true);

// Include environmental specific SSL configuration.
listener.setSSLEngineConfig(...);

SpdyAddOn sdpyAddon = new SpdyAddOn(); // optionally configure
listener.registerAddOn(spdyAddon);

httpServer.addListener(listener);
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="SPDY_Server_Push">SPDY Server Push</h3> 
  <p>Starting with @VERSION@, Grizzly offers support for SPDY server push mechanism <a class="externalLink" href="http://tools.ietf.org/html/draft-mbelshe-httpbis-spdy-00#section-3.3">http://tools.ietf.org/html/draft-mbelshe-httpbis-spdy-00#section-3.3</a>.</p> 
  <blockquote> 
   <p>Quote:<br />SPDY enables a server to send multiple replies to a client for a single request. The rationale for this feature is that sometimes a server knows that it will need to send multiple resources in response to a single request. Without server push features, the client must first download the primary resource, then discover the secondary resource(s), and request them. Pushing of resources avoids the round-trip delay…</p> 
  </blockquote> 
  <p>For sure, one might ask “what if the client already has pushed resource cached locally?” It is true, we probably should not push all the associated resources blindly, for example we probably should not push a huge file when we are not sure whether the client already has it, on other side it might be a good idea to push small icon, javascript, css resources even if the client has them already cached because additional round-trips (especially for mobile networks) might be more time consuming than receiving extra data.</p> 
  <p>Grizzly provides <i>PushResource</i> builder in order to construct the descriptor for the resource we want to push. For example:</p> 
  <div class="source"> 
   <pre>File imageFile = new File(&quot;imgs/1.png&quot;);

PushResource pushResource = PushResource.builder()
    .statusCode(HttpStatus.OK_200)
    .contentType(&quot;image/png&quot;)
    .source(
            Source.factory(spdyStream)
            .createFileSource(imageFile))
    .build();

spdyStream.addPushResource(&quot;https://thishost:7070/imgs/1.png&quot;, pushResource);
</pre> 
  </div> 
  <p>In the sample above we instruct SPDY stream to initiate server push, and send image file represented by the <a class="externalLink" href="http://docs.oracle.com/javase/7/docs/api/java/io/File.html">File</a> object. Similarly it is possible to build <i>PushResource</i> based on <a class="externalLink" href="https://grizzly.java.net/docs/2.3/apidocs/org/glassfish/grizzly/Buffer.html">Grizzly Buffer</a>, byte[] or <a class="externalLink" href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html">String</a>.</p> 
  <p>It is also possible to customize <i>PushResource</i> status code, reason phrase and headers like:</p> 
  <div class="source"> 
   <pre>// Push redirect information, so the client will not need to make additional
// request to get this information from the server

PushResource pushResource = PushResource.builder()
    .statusCode(HttpStatus.MOVED_PERMANENTLY_301)
    .header(Header.Location, &quot;https://anotherhost:7070/imgs/1.png&quot;)
    .source(
        Source.factory(spdyStream)
        .createStringSource(&quot;The resource has been moved&quot;))
    .build();

spdyStream.addPushResource(&quot;https://thishost:7070/imgs/1.png&quot;, pushResource);
</pre> 
  </div> 
  <p>And finally to give you more idea how the complete code looks like, here is an <i>HttpHandler</i> example:</p> 
  <div class="source"> 
   <pre>public class SpdyPushHttpHandler extends HttpHandler {

    @Override
    public void service(Request request, Response response) throws Exception {

        // Get SpdyStream information
        final SpdyStream spdyStream =
                (SpdyStream) request.getAttribute(SpdyStream.SPDY_STREAM_ATTRIBUTE);

        // If spdyStream is null - it is not a SPDY based request
        if (spdyStream != null) {
            // Push the file resource (image)
            spdyStream.addPushResource(
                    &quot;https://serverhost:serverport/imgs/1.png&quot;,
                    PushResource.builder()
                    .contentType(&quot;image/png&quot;)
                    .statusCode(HttpStatus.OK_200)
                    .source(Source.factory(spdyStream)
                        .createFileSource(imgFile))
                    .build());
        }

        // Send the main page here
        response.setContentType(&quot;text/html&quot;);

        final Writer w = response.getWriter();
        StringBuilder sb = new StringBuilder(128);
        sb.append(&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;SPDY Push Test&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&quot;);

        // Here we have the image reference on the main page
        sb.append(&quot;&lt;img src=\&quot;/imgs/1.png\&quot; /&gt;&quot;);

        sb.append(&quot;&lt;/body&gt;&lt;/html&gt;&quot;);

        response.setContentLength(sb.length());
        w.write(sb.toString());
    }
}
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="SPDY_Configuration_Grizzly_standalone">SPDY Configuration (Grizzly standalone)</h3> 
  <p>Here’s the high-level overview of getting SPDY working with a standalone Grizzly HTTP application.</p> 
  <ul> 
   <li> <p>Include the grizzly-npn-bootstrap-1.0.jar in the bootclasspath of the Grizzly application: -Xbootclasspath/p:&lt;path-to-jar&gt;.</p></li> 
   <li> <p>Register the SpdyAddon with the NetworkListener.</p></li> 
  </ul> 
  <p>The SpdyAddon currently exposes two properties that primarily control the memory characteristics of SPDY on the server side.</p> 
  <table border="0" class="bodyTable table table-striped table-hover"> 
   <caption>
     SpdyAddOn Properties 
   </caption> 
   <tbody> 
    <tr class="odd"> 
     <td align="left">maxConcurrentStreams</td> 
     <td align="left">Configures how many streams may be multiplexed over a single connection. The default is 100.</td> 
    </tr> 
    <tr class="even"> 
     <td align="left">initialWindowSizeInBytes</td> 
     <td align="left">Configures how much memory each stream will consume on the server side. The default is 64KB.</td> 
    </tr> 
    <tr class="odd"> 
     <td align="left">maxFrameLength</td> 
     <td align="left">Configures the upper bound on allowable frame sizes. Frames above this bound will be rejected.</td> 
    </tr> 
   </tbody> 
  </table> 
 </div> 
 <div class="section"> 
  <h3 id="SPDY_Configuration_GlassFish_4">SPDY Configuration (GlassFish 4)</h3> 
  <p>There’s a little more involved when configuring GlassFish 4 for SPDY support.</p> 
  <ul> 
   <li> <p>Copy the grizzly-npn-osgi-1.0.jar to the GF_HOME/modules directory.</p></li> 
   <li> <p>Copy the <a class="externalLink" href="mailto:grizzly-spdy-@VERSION@.jar">grizzly-spdy-@VERSION@.jar</a> to the GF_HOME/modules directory.</p></li> 
   <li> <p>Update the domain.xml’s JVM configuration section to include a reference to the grizzly-npn-bootstrap-1.0.jar within -Xbootclasspath (-Xbootclasspath/p:&lt;path-to-jar&gt;. We recommend adding a new transport to the domain.xml that sets the io-strategy property on the transport named TCP will need to be set to &quot;org.glassfish.grizzly.strategies.SameThreadIOStrategy.</p></li> 
   <li> <p>Start the server.</p></li> 
   <li> <p>Run the asadmin command enable-spdy. Here’s an example of the command being run against the default ssl listener in GlassFish:</p> <p><i>asadmin enable-spdy http-listener-2</i></p></li> 
  </ul> 
  <p>When running enable-spdy, it is possible to pass SpdyAddon configuration values via –max-concurrent-streams, –initial-window-size-bytes, and max-frame-length-in-bytes. These properties may also be set after-the-fact using <i>asadmin set</i>.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Dependencies">Dependencies</h3> 
  <p>As stated previously, in order to use SPDY with Grizzly, you will need to use OpenJDK 7u14. The following JARs are also required. See the following table for details:</p> 
  <table border="0" class="bodyTable table table-striped table-hover"> 
   <caption>
     SPDY Dependencies 
   </caption> 
   <thead> 
    <tr class="header"> 
     <th align="left">Dependency</th> 
     <th align="left">Description</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr class="odd"> 
     <td align="left"><a class="externalLink" href="http://search.maven.org/remotecontent?filepath=org/glassfish/grizzly/grizzly-npn-api/1.0/grizzly-npn-api-1.0.jar">grizzly-npn-api-1.0.jar</a></td> 
     <td align="left">This JAR exposes the Grizzly-side of the Next Protocol Negotiation API. Typically won't be needed by developers unless they wish to expose custom protocols via Next Protocol Negotiation.</td> 
    </tr> 
    <tr class="even"> 
     <td align="left"><a class="externalLink" href="http://search.maven.org/remotecontent?filepath=org/glassfish/grizzly/grizzly-npn-bootstrap/1.0/grizzly-npn-bootstrap-1.0.jar">grizzly-npn-bootstrap-1.0.jar</a></td> 
     <td align="left">Includes both the Next Protocol Negotiation API and the SSL implementation overrides. This JAR must be specified on the bootclasspath in order for Next Protocol Negotiation to function.</td> 
    </tr> 
    <tr class="odd"> 
     <td align="left"><a class="externalLink" href="http://search.maven.org/remotecontent?filepath=org/glassfish/grizzly/grizzly-npn-osgi/1.0/grizzly-npn-osgi-1.0.jar">grizzly-npn-osgi-1.0.jar</a></td> 
     <td align="left">This JAR is an OSGi bundle fragment. It's used to ensure the Next Protocol Negotiation API classes are properly available to an OSGi runtime.</td> 
    </tr> 
   </tbody> 
  </table> 
  <p>One item to keep in mind is that the SSL part of the NPN implementation is sensitive the the OpenJDK version being used. It won’t work with older update releases, and may not work with newer. If testing with a newer OpenJDK release and an issue is found, please log a <a class="externalLink" href="http://java.net/jira/browse/GRIZZLY">bug</a>.</p> 
 </div> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->
	
	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li>
							<a href="index.html" title="Home">Home </a>
						</li>
						<li>
							<a href="license.html" title="License">License </a>
						</li>
						<li>
							<a href="using.html" title="Who's Using Grizzly">Who's Using Grizzly </a>
						</li>
						<li class="nav-header">Download</li>
						<li>
							<a href="dependencies.html" title="Download">Download </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Contribute</li>
						<li>
							<a href="contribute.html" title="Contribute">Contribute </a>
						</li>
						<li>
							<a href="http://stackoverflow.com/questions/tagged/grizzly" title="StackOverflow" class="externalLink">StackOverflow </a>
						</li>
						<li>
							<a href="https://twitter.com/project_grizzly" title="Twitter" class="externalLink">Twitter </a>
						</li>
						<li>
							<a href="mailing.html" title="Mailing Lists">Mailing Lists </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Project Info</li>
						<li>
							<a href="scm.html" title="Source Control">Source Control </a>
						</li>
						<li>
							<a href="https://java.net/jira/browse/GRIZZLY/" title="Issue Tracking" class="externalLink">Issue Tracking </a>
						</li>
						<li>
							<a href="mailing.html" title="Mailing Lists">Mailing Lists </a>
						</li>
						<li>
							<a href="team-list.html" title="Project Team">Project Team </a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>
		
	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2017. All Rights Reserved.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->

	<!-- Fallback jQuery loading from Google CDN:
	     http://stackoverflow.com/questions/1014203/best-way-to-use-googles-hosted-jquery-but-fall-back-to-my-hosted-library-on-go -->
	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script type="text/javascript">
		if (typeof jQuery == 'undefined')
		{
			document.write(unescape("%3Cscript src='https://grizzly.java.net/js/jquery-1.8.3.min.js' type='text/javascript'%3E%3C/script%3E"));
		}
	</script>
	
	<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>
	<script src="https://grizzly.java.net/js/lightbox.js"></script>
	<script src="https://grizzly.java.net/js/jquery.smooth-scroll.min.js"></script>
	<!-- back button support for smooth scroll -->
	<script src="https://grizzly.java.net/js/jquery.ba-bbq.min.js"></script>
	<script src="//yandex.st/highlightjs/7.3/highlight.min.js"></script>

	<script src="https://grizzly.java.net/js/reflow-skin.js"></script>
	
	</body>
</html>
